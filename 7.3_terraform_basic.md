# 7.3. Основы и принцип работы Терраформ

# Задание №1 Создадим бэкэнд в S3 (я делал в YC у меня Yandex Object Storage)

Если в рамках предыдущего задания у вас уже есть аккаунт AWS, то давайте продолжим знакомство со взаимодействием терраформа и aws.

1. Создайте s3 бакет, iam роль и пользователя от которого будет работать терраформ. Можно создать отдельного пользователя, а можно использовать созданного в рамках предыдущего задания, просто добавьте ему необходимы права, как описано здесь.
2. Зарегистрируйте бэкэнд в терраформ проекте как описано по ссылке выше.

![Снимок экрана от 2022-07-16 11-45-08](https://user-images.githubusercontent.com/93032289/179349541-74eae3ac-b62d-4e9e-a37d-3b7f073cf980.png)

# Задание №2 Инициализируем проект и создаем воркспейсы.


1. Выполните terraform init:
  - если был создан бэкэнд в S3, то терраформ создат файл стейтов в S3 и запись в таблице dynamodb.
  - иначе будет создан локальный файл со стейтами.
2. Создайте два воркспейса stage и prod.
3. В уже созданный aws_instance добавьте зависимость типа инстанса от вокспейса, что бы в разных ворскспейсах использовались разные instance_type.
4. Добавим count. Для stage должен создаться один экземпляр ec2, а для prod два.
5. Создайте рядом еще один aws_instance, но теперь определите их количество при помощи for_each, а не count.
6. Что бы при изменении типа инстанса не возникло ситуации, когда не будет ни одного инстанса добавьте параметр жизненного цикла create_before_destroy = true в один из рессурсов aws_instance.
7. При желании поэкспериментируйте с другими параметрами и рессурсами.

   В виде результата работы пришлите:

  -  Вывод команды terraform workspace list.
  -  Вывод команды terraform plan для воркспейса prod.

![Снимок экрана от 2022-07-16 12-51-01](https://user-images.githubusercontent.com/93032289/179351156-6fa1deda-4455-497f-ab26-9da51c088b2d.png)
